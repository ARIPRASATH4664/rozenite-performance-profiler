"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("react"),d="rozenite",D=()=>{const e=global.__FUSEBOX_REACT_DEVTOOLS_DISPATCHER__,n=e.BINDING_NAME;return global[n]!=null?e.initializeDomain(d):null},v=()=>new Promise(e=>{const n=t=>{t.name===d&&(global.__FUSEBOX_REACT_DEVTOOLS_DISPATCHER__.onDomainInitialization.removeEventListener(n),setTimeout(()=>e(t)))};global.__FUSEBOX_REACT_DEVTOOLS_DISPATCHER__.onDomainInitialization.addEventListener(n)}),f=async()=>{const e=new Set;let n=D();n||(n=await v());const t=()=>{if(!n)throw new Error("Domain not initialized");return n},s=o=>{o.name===d&&(n&&e.forEach(r=>{n.onMessage.removeEventListener(r)}),n=o,e.forEach(r=>{o.onMessage.addEventListener(r)}))};return global.__FUSEBOX_REACT_DEVTOOLS_DISPATCHER__.onDomainInitialization.addEventListener(s),{send:o=>{t().sendMessage(o)},onMessage(o){return e.add(o),t().onMessage.addEventListener(o),{remove:()=>{e.delete(o),t().onMessage.removeEventListener(o)}}},close:()=>{global.__FUSEBOX_REACT_DEVTOOLS_DISPATCHER__.onDomainInitialization.removeEventListener(s)}}},T=async()=>f(),w=async()=>{const e=new Set,n=t=>{e.forEach(s=>{s(t.data)})};return window.addEventListener("message",n),{send:t=>{window.parent.postMessage({type:"rozenite-message",payload:t},"*")},onMessage:t=>(e.add(t),{remove:()=>{e.delete(t)}}),close:()=>{e.clear(),window.removeEventListener("message",n)}}},C=async()=>"__ROZENITE_PANEL__"in window?w():T(),m=e=>typeof e!="object"||e===null||!("type"in e)||!("payload"in e)||!("pluginId"in e)?null:e,E=new Map,y=async e=>{const n=await C(),t=new Map,s=async l=>{const i=m(l);if(!i||i.pluginId!==e)return;const a=t.get(i.type);a!=null&&a.forEach(g=>{g(i.payload)})},c=(l,i)=>{n.send({pluginId:e,type:l,payload:i})},o=n.onMessage(s);return{send:c,onMessage:(l,i)=>{const a=t.get(l)??new Set;return a.add(i),t.set(l,a),{remove:()=>{a.delete(i)}}},close:()=>{t.clear(),o.remove(),n.close()}}},_=async e=>{const n=E.get(e);if(n!=null)return n;const t=y(e);E.set(e,t);const s=await t;return E.set(e,s),s},S=({pluginId:e})=>{const[n,t]=u.useState(null),[s,c]=u.useState(null);if(u.useEffect(()=>{let o=!0,r=null;const l=async()=>{try{r=await _(e),o&&t(r)}catch(a){console.error("Error setting up client",a),o&&c(a)}},i=async()=>{try{r!=null&&r.close()}catch{}};return l(),()=>{o=!1,i()}},[e]),s!=null)throw s;return n};exports.getRozeniteDevToolsClient=_;exports.useRozeniteDevToolsClient=S;
